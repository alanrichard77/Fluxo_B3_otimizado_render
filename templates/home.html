
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fluxo de Investidores B3</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0f172a] text-white">
<header class="bg-gradient-to-r from-sky-900 to-indigo-900 p-6 text-center shadow-lg">
  <h1 class="text-3xl font-bold drop-shadow-xl">Fluxo de Investidores B3</h1>
  <p class="text-sm mt-1 text-slate-300">Acompanhe o movimento de capital no mercado, dados mais recentes</p>
</header>

<main class="max-w-7xl mx-auto px-4 py-8 space-y-8">

  <form method="POST" class="flex flex-col md:flex-row items-center gap-3 justify-center">
    <input type="hidden" name="acao" value="atualizar" />
    <div class="flex items-center gap-2">
      <label for="start_date" class="text-sm text-slate-300">Início</label>
      <input id="start_date" name="start_date" type="date" value="{{ start_date }}" class="bg-[#0b1220] border border-slate-700 rounded-lg px-3 py-2 text-sm" />
    </div>
    <div class="flex items-center gap-2">
      <label for="end_date" class="text-sm text-slate-300">Fim</label>
      <input id="end_date" name="end_date" type="date" value="{{ end_date }}" class="bg-[#0b1220] border border-slate-700 rounded-lg px-3 py-2 text-sm" />
    </div>
    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-5 rounded-xl shadow-md transition">Atualizar Gráfico</button>
  </form>

  {% if resumo %}
  <section class="grid grid-cols-1 md:grid-cols-5 gap-3">
    {% for cat in categorias %}
    {% set val = resumo.get(cat, 0.0) %}
    <div class="bg-[#162338] rounded-xl p-4 shadow-md">
      <h3 class="text-sm text-slate-300">{{ cat }}</h3>
      <p class="text-xl font-bold mt-1">
        {% if val >= 0 %}+ R$ {{ '%.1f'|format(val)|replace('.', ',') }} bi{% else %}– R$ {{ ('%.1f'|format(-val))|replace('.', ',') }} bi{% endif %}
      </p>
      <p class="text-xs mt-1 {% if val >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
        {% if val >= 0 %}Entrada líquida{% else %}Saída líquida{% endif %}
      </p>
    </div>
    {% endfor %}
  </section>
  {% endif %}

  {% if imagem %}
  <div class="bg-[#1e293b] p-4 rounded-xl shadow-lg">
    <img src="data:image/png;base64,{{ imagem }}" alt="Gráfico de Fluxo de Investidores" class="w-full rounded">
  </div>
  {% endif %}

  <section class="bg-[#0b1220] border border-slate-700 rounded-xl p-4">
    <h2 class="text-lg font-semibold mb-3">Resumo mês a mês</h2>
    {% if painel and painel|length > 0 %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      {% for item in painel %}
      <div class="bg-[#162338] rounded-lg p-3">
        <p class="text-sm text-slate-300">{{ item.mes }}</p>
        <p class="mt-1 text-sm">Maior comprador: <span class="font-semibold">{{ item.maior_comprador }}</span> • <span class="text-green-400">{{ item.saldo_compra }}</span></p>
        <p class="text-sm">Maior vendedor: <span class="font-semibold">{{ item.maior_vendedor }}</span> • <span class="text-red-400">{{ item.saldo_venda }}</span></p>
      </div>
      {% endfor %}
    </div>
    {% else %}
      <p class="text-slate-400 text-sm">Sem dados para o período selecionado.</p>
    {% endif %}
  </section>

  <footer class="text-center text-sm text-slate-400 border-t border-slate-700 pt-6">
    <p><strong>Fonte:</strong> B3 e Dados de Mercado • Último dado de fluxo: {{ last_date if last_date else '-' }}</p>
    <p><a href="https://www.instagram.com/alan_richard" class="underline">@alan_richard</a> • Dashboard Fluxo de Investidores • Valores em bilhões de reais</p>
  </footer>
</main>
</body>
</html>
